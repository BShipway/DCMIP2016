\documentclass[times,doublespace]{fldauth}

\usepackage{hyperref}
\usepackage{lineno}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{graphicx}

\newcommand{\vb}{\mathbf}
\newcommand{\vg}{\boldsymbol}
\newcommand{\diff}[2]{\frac{d #1}{d #2}}
\newcommand{\pdiff}[2]{\frac{\partial #1}{\partial #2}}
\newcommand{\avg}[1]{\overline{#1}}
\newcommand{\dblavg}[1]{\overline{\overline{#1}}}
\newcommand{\mat}[1]{\mathbf{\mathsf{#1}}}
\newcommand{\arccot}{\mathrm{arccot}}

\newcommand{\rbd}[1]{\raisebox{-1.5ex}[1.5ex]{#1}}
\newcommand{\rbu}[1]{\raisebox{0.5ex}[-0.5ex]{#1}}
\newcommand{\rb}[1]{\raisebox{2ex}[-2ex]{#1}}

\newcommand\T{\rule{0pt}{2.6ex}}
\newcommand\B{\rule[-1.2ex]{0pt}{0pt}}


\begin{document}
\setcounter{section}{-1}

\title{Dynamical Core Model Intercomparison Project (DCMIP) \\
 Test Case Document}
\author{Antonin Verlet-Banide\\ Paul Aaron Ullrich \\Christiane Jablonowski \\ Kevin Reed \\ Colin Zarzycki \\ Peter Hjort Lauritzen \\ Ramachandran D. Nair \\ \vspace{3cm} DCMIP Summer School: June 2016}

\maketitle

\begin{center}
Version 0.1 \\
\today
\end{center}

\vspace{2cm}

\begin{center}
Email questions to \textbf{dcmip@ucar.edu}
\end{center}

\clearpage

\section*{Overview of the Test Case Suite}

The set of test cases collected in this document has been developed for the 2016 Dynamical Core Model Intercomparison Project (DCMIP2016) in an effort to understand the broad treatment of the equations of motion within a variety of atmospheric General Circulation Models (GCMs). In contrast with the test cases described in the DCMIP2012 and DCMIP2008 test case documents, the suite of test cases that are described here focus on issues related to physics-dynamics coupling, non-hydrostatic scales and modeling systems that support variable resolution.  To better isolate these features, the majority of tests described in this document do not include topographic forcing and emphasize features that have a relatively small spatial footprint relative to the global simulation domain.  The tests proposed here have been drawn from the recent literature on global model intercomparison testing.  To support the integration of these tests into existing models, a collection of initialization routines have been provided that can be used for very quickly setting up the initial conditions.  Augmented Kessler physics routines have also been provided to support simple moisture feedbacks, a boundary layer parameterization and surface friction.  If models provide both a shallow-atmosphere and deep-atmosphere configuration, we recommend the shallow-atmosphere setup to avoid imbalances in the initial conditions. It is further expected that most models will be run under a non-hydrostatic configuration, which will permit a correct solution to the mesoscale storm test.  If models can be configured both as a hydrostatic and non-hydrostatic dynamical core, additional hydrostatic simulations might be conducted to evaluate the direct impact of the hydrostatic approximation.

Table \ref{tab:TestCases} provides an overview of all test cases described in this document.  The test cases are listed in order of increasing complexity, beginning with pure advection tests and non-rotating model configurations, dry baroclinic waves, and extending to test cases of intermediate complexity, incorporating moisture and very simplified physical parameterizations. In addition, an optional 10-day aqua-planet simulation with the model's own physical parameterization package is suggested. 

\begin{table}[h]

\caption{A list of test cases described in this document.} \label{tab:TestCases}
%\ \\
\begin{tabular*}{\textwidth}{@{\extracolsep{\fill}}ll}
\hline Test Case \T \B& Description \\
\hline \multicolumn{2}{l}{Tier 1 Test Cases (Required)} \T \B \\
\hline 1-1 \T & Steady-state Terminator chemistry (pure advection) \\
1-2 \T & Moist baroclinic wave \\
1-3 \T & Idealized Tropical cyclone \\
1-4 \T & Mesoscale storm \\
\hline \multicolumn{2}{l}{Tier 2 Test Cases (Optional)} \T \B \\  \hline 
2-1 \T \B & Moist Held-Suarez test  \\ \hline
\hline 
\end{tabular*}

\end{table}

\section{Practical Considerations}

\subsection{List of Symbols}
Throughout this test case document we will use $\lambda \in [0, 2 \pi)$ to denote longitude, $\varphi \in [-\pi/2, \pi/2]$ to represent latitude, $z$ to represent the height with respect to the mean sea level (assumed to be zero), and $p$ to symbolize the pressure. Table \ref{tab:symbols} lists the symbols used for the initialization of the model.

\begin{table}[h]
\caption{List of symbols for the model initialization} \label{tab:symbols}
\begin{center}
\begin{tabular}{cl}
\hline Symbol & Description \\ \hline 
$\lambda$ & Longitude (in radians) \\
$\varphi$ & Latitude (in radians) \\
$z$ & Height with respect to mean sea level (set to zero) \\
$p_s$ & Surface pressure ($p_s$ of moist air if $q>0$) \\
$\Phi_s$ & Surface geopotential \\
$z_s$ & Surface elevation with respect to mean sea level (set to zero) \\
$u$ & Zonal wind \\
$v$ & Meridional wind \\
$w$ & Vertical velocity \\
$\omega$ & Vertical pressure velocity  \\
$\delta$ & Divergence\\
$\zeta$ & Relative vorticity\\
$p$ & Pressure (pressure of moist air if $q>0$) \\
$\rho$ & Density (density of moist air if $q>0$)\\
$T$ &Temperature \\
$T_v$ & Virtual temperature \\
$\Theta$ & Potential temperature \\
$\Theta_v$ & Virtual potential temperature \\
$q$ & Specific humidity \\
$P_{ls}$ & Large-scale precipitation rate \\
$q_c$ & Cloud water mixing ratio \\
$q_r$ & Rain water mixing ratio \\
$q_{Cl}$ & Singlet chlorine mixing ratio \\
$q_{Cl2}$ & Chlorine gas mixing ratio \\
\hline 
\end{tabular}
\end{center}
\end{table}

\subsection{List of Physical Constants}
A list of physical constants which are used throughout this document is given in Table \ref{tab:PhysicalConstants}.  Constants which are specific to each test case are similarly tabulated at the beginning of each section.

\begin{table}[h]
\caption{A list of physical constants used in this document.} \label{tab:PhysicalConstants}
%\ \\
\begin{tabular*}{\textwidth}{@{\extracolsep{\fill}}lll}
\hline Constant & Description & Value \\
\hline $a_{\tiny \mbox{ref}}$ & Radius of the Earth & $6.37122 \times 10^{6}\ \mbox{m}$ \\
$\Omega_{\tiny \mbox{ref}}$ & Rotational speed of the Earth & $7.292\ \times 10^{-5}\ \mbox{s}^{-1}$ \\
$X$ & Reduced-size Earth reduction factor & variable (default $= 1$) \\
$a$ & Scaled radius of the Earth & $a_{\tiny \mbox{ref}} / X$ \\
$\Omega$ & Scaled rotational speed of the Earth & $\Omega_{\tiny \mbox{ref}} \cdot X$ \\
$g$ & Gravity & $9.80616\ \mbox{m}\ \mbox{s}^{-2}$ \\
$p_0$ & Reference pressure & $1000\ \mbox{hPa}$ \\
$c_p$ & Specific heat capacity of dry air at constant pressure & $1004.5\ \mbox{J}\ \mbox{kg}^{-1}\ \mbox{K}^{-1}$ \\
$c_v$ & Specific heat capacity of dry air at constant volume & $717.5\ \mbox{J}\ \mbox{kg}^{-1}\ \mbox{K}^{-1}$ \\
$R_d$ & Gas constant for dry air & $287.0\ \mbox{J}\ \mbox{kg}^{-1}\ \mbox{K}^{-1}$ \\
$R_\nu$ & Gas constant for water vapor & $461.5$ J kg$^{-1}$ K$^{-1}$ \\
$\kappa$ & Ratio of $R_d$ to $c_p$ & $R_d/c_p = 2/7$ \\
$\varepsilon$ & Ratio of $R_d$ to $R_\nu$ & $R_d/R_\nu \approx 0.622$ \\
$M_v$ & Constant for virtual temperature conversion & $0.608$ \\
$\rho_{water}$ & Density of water & 1000 kg m$^{-3}$ \\
\hline 
\end{tabular*}

\end{table}

\subsection{Great Circle Distance}

The great circle distance is used throughout the document and is given by
\begin{equation}
R(\lambda_1, \varphi_1; \lambda_2, \varphi_2) = a \arccos \left( \sin \varphi_1 \sin \varphi_2 + \cos \varphi_1 \cos \varphi_2 \cos (\lambda_1 - \lambda_2) \right).
\end{equation}

\subsection{Choice of Prognostic Variables and Equation of State}

It is assumed throughout this document that the moist ideal gas law is satisfied,
\begin{equation} \label{eq:idealgaslaw}
p = \rho R_d T_v, 
\end{equation} where the virtual temperature is defined in terms of the temperature as
\begin{equation}
T_v = T (1 + M_v q).
\end{equation}  The virtual potential temperature is similarly related to the potential temperature via the relationship
\begin{equation}
\theta_v = \theta (1 + M_v q).
\end{equation}

\subsection{Small-Planet Experiments}
The test case suite makes use of small-planet experiments that have the potential to expose the differences between hydrostatic and non-hydrostatic modeling approaches at reasonable computational cost. In particular, the small-planet setups allow the evaluation of the model behavior with physical grid spacings down to a few hundred meters. In some instances, we suggest small planets with circumferences of about 40 km and a vertical extent of 30 km which raises questions concerning the validity of the shallow-atmosphere approximation. However, since the experiments are not compared to observations, we still ask for the use of the shallow-atmosphere approach to allow for intercomparisons among the DCMIP models and to avoid imbalances of the initial conditions.

When a non-unity reduction factor $X$ is applied in order to shrink the size of the Earth and thereby the physical grid spacing of the computational grid, a variety of model adjustments become necessary.
Most prominently these include the scaling of the radius, the rotational speed, the model time step and explicit viscosity parameters (if applied). The adjustment steps for small-planet simulations are:
\begin{itemize}
\item Divide the radius of the Earth $a_{\tiny \mbox{ref}}$ by $X$ to obtain the rescaled radius $a  = \frac{a_{\tiny \mbox{ref}}}{X}$.
\item Divide the length of the dynamics time step $\Delta t$ by $X$, especially if a CFL condition needs to be obeyed.
\item In case of rotating planets: multiply the Earth's angular velocity $\Omega_{\tiny \mbox{ref}}$ by the factor $X$ to obtain the rescaled angular speed $\Omega = \Omega_{\tiny \mbox{ref}}X$. This guarantees that the characteristics of Rossby waves are comparable in unscaled and scaled model experiments since the Rossby number stays constant.
\item In case of explicit diffusion of type $K_{2k}\nabla^{2k}$ with a prescribed diffusion coefficient $K_{2k}$ (and $k=1,2\ldots$) divide $K_{2k}$ by the factor $X^{2k-1}$. This accounts for a reduction of the e-folding time $\tau$  and the horizontal grid spacing $\Delta x$ according to the relationship $\frac{(\Delta x)^{2k}/X^{2k}}{\tau/X}$. The $K_{2k}$ diffusion coefficient is typically based on such a relationship. Note that some models might provide an automatic scaling of the diffusion coefficients according to the actual dynamics time step and grid spacing. If a model applies Rayleigh friction as a sponge near the model top, the friction coefficient needs to be multiplied by X. Again, this corresponds to a reduction of the e-folding frictional time scale $\frac{1}{\tau/X} = \frac{X}{\tau}$ in small-planet experiments.
\item If physical forcing mechanisms are present on the right hand side of the equations of motion the strengths of the physical forcing must be increased (multiplied) by the factor X. This will not be applicable to the test cases presented here unless Rayleigh friction is considered as such a forcing as outlined above.
\end{itemize}

\subsection{Notes on the Requested Model Output}
\label{sec:notes_output}
\subsubsection{NetCDF}
A fundamental requirement for the exchange of scientific data is the ability to  precisely describe the physical quantities being represented. Therefore, special attention needs to be paid to the representation of the model data in the output files. We require data in the `Network Common Data Form' (netCDF) \cite{netcdf} that adhere to the netCDF Climate and Forecast (CF) metadata convention (if possible to version 1.6 from Dec. 2011 \cite{netcdf-cf}). All netCDF files should have the file name extension `.nc'.
We specify details of the netCDF requirements in Appendix~\ref{sec:netcdf} and will also provide help via NCO operators before the DCMIP event to make the data CF-compliant if necessary. Please communicate your output constraints or concerns (if any) to the DCMIP organizers as soon as possible. We will also ask for example data sets before the DCMIP event.

\subsubsection{Computational grid}
Most DCMIP models utilize non-orthogonal computational grids like cubed-sphere grids, icosahedral grids, hexagonal grid, Voronoi grids or Yin-Yang grids. Among the mix of DCMIP GCMs are even models that provide provisions for variable-resolution grids. We encourage the use of the variable-resolution configurations as an additional test option whenever possible.
This raises questions concerning the desired representation of the data in the netCDF output files. 

If models on non-traditional (non latitude-longitude) grids are used, we ask for two output files that represent the identical model run. The first output file should be written on the native computational grid without any interpolations. In addition, most models will likely provide built-in provisions for interpolated output to a regular (equidistant in degrees) latitude-longitude grid. We therefore also ask for a second output file that represents the data on model levels on the interpolated latitude-longitude grid. We ask for co-located  (Arakawa-A type) data on the interpolated grid regardless of the GCM's staggering options. The grid spacing of the interpolated grid should be comparable to the actual resolution of the model run, which might be for example $1^\circ \times 1^\circ$. Using this example, the interpolated grid will have $180 \times 360$ horizontal grid points if the equator and pole points are not part of the interpolated grid. If the equator and pole points are included it yields $181 \times 360$ horizontal grid points. If models can freely choose their interpolation points, we suggest the $180 \times 360$ configuration for the given example. If models need to include the equator and pole points, we ask for the $181 \times 360$ horizontal grid. 

Models on regular latitude-longitude or Gaussian grids should only provide a single output file using their native horizontal resolution and model levels. If reduced Gaussian grids are utilized a second file on the full Gaussian grid is requested. 
If models are run with variable-resolution grids, we leave the choice of the best suitable interpolation grid to the modeling group. We ask to write all output variables for each experiment to the same file.

\subsection{Short Note on Data Analysis and Visualization}
We will provide NCAR Command Language (NCL) scripts to help visualize the model results and provide analysis functions. In addition, the DCMIP participants will have access to interactive Graphical User Interfaces (GUIs) to support the visualization and model intercomparison. Among the GUIs are the netCDF viewers Ncview and Panoply which are public domain tools and locally installed on the NCAR mirage server. In addition, we expect to provide some basic online visualization capabilities via NOAA's Live Access Server (LAS) software. A key to the successful visualization is the adherence of the output data sets to the netCDF-CF standard (see Appendix \ref{sec:netcdf}).

\subsection{Short Note on the Fortran Templates}
\label{sec:template}
We have provided a set of stand-alone Fortran routines that compute the initial conditions for all test cases. They are named

\begin{itemize}
\item \texttt{baroclinic\_wave\_test.f90}
\item \texttt{tropical\_cyclone\_test.f90}
\item \texttt{mesoscale\_storm\_test.f90}
\end{itemize}

We have also provided a set of stand-alone Fortran routines that compute tendencies associated with the physical parameterizations.  They are named

\begin{itemize}
\item \texttt{terminator.f90}
\item \texttt{kessler.f90}
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\clearpage
\section{Moist Baroclinic Wave}   
 
This baroclinic instability test of \cite{ullrich2014proposed} considers a reference state in geostrophic and hydrostatic balance that satisfies the conditions for baroclinic instability.  Although a perfect model should be able to maintain this state indefinitely, small truncation errors associated with numerical inaccuracies and grid structure will trigger the development of the wave modes associated with baroclinic development.  To control the development of the baroclinic wave, a small perturbation (but one which is large compared with machine truncation) is added to the flow so as to trigger the development of a wave over a period of approximately 10 days.  A moist variant of the dry dynamical test of \cite{ullrich2014proposed} is considered here so as to understand the impact of moisture feedbacks on the development of the wave.

This test case is similar in character to the test of \cite{jablonowski2006baroclinic}, but has a number of key differences:  (1) this test is an analytical solution of the equations of motion in height ($z$) coordinates, (2) the bottom topography is zero throughout the domain, (3) the new test case does not have a distinct stratosphere (the presence of a stratosphere is largely irrelevant for understanding baroclinic development), and (4) the velocity field goes to zero at the model surface.
 
\begin{table}[h]

\caption{List of constants used for the Moist Baroclinic Wave test case}
\label{test4:tab}
\begin{tabular*}{\textwidth}{@{\extracolsep{\fill}}lll}
\hline Constant & Value & Description \\
\hline 
$z_{\tiny \mbox{top}}$ & $44000\ \mbox{m}$ & Recommended height position of the model top \\
$p_{\tiny \mbox{top}}$ & $\approx 2.26$ hPa & Recommended pressure at the model top\\
$X$ & $1$ & Reduced-size planet scaling factor, see below\\
$a$ & $a_{\tiny \mbox{ref}}/X$ & Scaled radius of the Earth \\
%$Z_r$ & $1$ & Shallow atmosphere parameter \\
%$Z_r$ & $(z+a)/a$ & Radius Ratio\\
$\Omega$ & $\Omega_{\tiny \mbox{ref}}X$ & Scaled angular speed of the Earth \\
$p_s$ & $1000\ \mbox{hPa}$ & Surface pressure (constant) \\
$p_0$ & $1000\ \mbox{hPa}$ & Reference pressure (constant) \\
$u_0$ & $35\ \mbox{m\ s}^{-1}$ & Maximum amplitude of the zonal wind \\
$u_p$ & $1\ \mbox{m\ s}^{-1}$ & Maximum amplitude of the zonal wind perturbation \\
$z_p$ & $15000\ \mbox{m}$ & Maximum height of the zonal wind perturbation \\
$\lambda_p$ & $\pi / 9$ & Longitude of the zonal wind perturbation centerpoint (20$^\circ$ E)\\
$\varphi_p$ & $2 \pi / 9$ & Latitude of the zonal wind perturbation centerpoint (40$^\circ$ N)\\
$R_p$ & $a / 10$ & Radius of the zonal wind perturbation \\
$T_0$ & $288\ \mbox{K}$ & Horizontal-mean temperature at the surface \\
$T_p$ & $240 \ \mbox{K}$ & Temperature at the polar surface\\
%$T_E$ & $310 \ \mbox{K}$ & Temperature at the equator\\
$\Gamma$ & $0.005\ \mbox{K\ m}^{-1}$ & Temperature lapse rate \\
$\Delta T$ & $4.8 \times 10^{5}\ \mbox{K}$ & Empirical temperature difference \\
$K$ & $3$ & Jet width parameter \\
$\varphi_w$ & $2 \pi / 9$ & Specific humidity latitudinal width parameter $(40^\circ)$\\
$p_w$ & $340\ \mbox{hPa}$ & Specific humidity vertical pressure width parameter \\
$q_0$ & $0.018$ kg/kg& Maximum specific humidity amplitude \\
$q_t$ & $1.0 \times 10^{-12}$ kg/kg & Specific humidity above artificial tropopause \\
$p_t$ & $10000\ \mbox{hPa}$ & Pressure at artificial tropopause \\  
\hline 
\end{tabular*}

\end{table}

\subsection{Reference State}

This section describes the analytical form of the reference state for the baroclinic wave.  The test case is initialized with a constant surface pressure and with a surface geopotential equal to zero.  The meridional wind in the reference state is zero. 

In the reference state, the virtual temperature is given by
\begin{equation}
T_v(\varphi, z) = \frac{1}{\tau_1(z)-\tau_2(z) I_T(\varphi)},
\label{virtTemp}
\end{equation} where $I_T(\varphi)$ is defined as
\begin{equation}
I_{T}(\varphi) =(\cos \varphi )^K-\frac{K}{K+2}(\cos \varphi )^{K+2},
\end{equation} and $\tau_1(z)$ and $\tau_2(z)$ are defined as follows:
\begin{align}
\tau_1(z) &= \frac{1}{T_0\exp\left(\frac{\Gamma z}{T_0}\right)} + \left( \frac{T_0-T_p}{T_0T_p} \right)\left[1-2\left(\frac{zT_pg}{(T_0-T_p)R_d}\right)^2\right] \exp\left[-\left(\frac{zT_pg}{(T_0-T_p)R_d}\right)^2\right] \\
\tau_2(z) &= \frac{(K-2)}{2} \left( \frac{T_0-T_p}{T_0T_p} \right) \left[1-2\left(\frac{zT_pg}{(T_0-T_p)R_d}\right)^2\right] \exp\left[-\left(\frac{zT_pg}{(T_0-T_p)R_d}\right)^2\right].
\end{align}  To maintain hydrostatic balance, the pressure is given by:
\begin{equation}
p(\varphi, z) = p_0\exp \left[ -\frac{g}{Rd}(\tau_{\text{int}_1}(z) -\tau_{\text{int}_2}(z) I_T(\varphi) ) \right]
\end{equation} with $\tau_{\text{int}_1}(z)$ and $\tau_{\text{int}_2}(z)$ given by
\begin{align}
\tau_{\text{int}_1}(z) &=\frac{\exp\left( \frac{\Gamma z}{T_0} \right)-1}{\Gamma} + z \left(\frac{T_0-T_p}{T_0T_p} \right) \exp\left[-\left(\frac{zT_pg}{(T_0-T_p)R_d}\right)^2\right] \\
\tau_{\text{int}_2}(z) &=\frac{(K-2)}{2} \left(\frac{T_0-T_p}{T_0T_p} \right) z \exp\left[-\left(\frac{zT_pg}{(T_0-T_p)R_d}\right)^2\right].
\end{align}  If density is a prognostic variable, it can be obtained from $p$, $T_v$ and the ideal gas law (\ref{eq:idealgaslaw}).  Finally, the zonal velocity is
\begin{equation}
u_{\text{ref}}(\varphi, z) = -\Omega_{\text{ref}} a_{\text{ref}} \cos(\varphi)+\sqrt{(\Omega_{\text{ref}} a_{\text{ref}} \cos(\varphi))^2+ a_{\text{ref}} \cos(\varphi)U(z,\varphi))},
\end{equation} where
\begin{equation}
U(z, \varphi) = \frac{g K}{a_{\text{ref}}} \tau_{\text{int}_2}(z) \left[ (\cos \varphi)^{K - 1} - (\cos \varphi)^{K + 1} \right] T_v(\varphi, z).
\end{equation} 

\subsection{Perturbations}

To trigger the development of the baroclinic wave, a perturbation is applied to the zonal velocity field that takes the form of a simple exponential bell with a vertical taper:
\begin{equation}
u^\prime(\lambda, \varphi, z) = \left\{ \begin{array}{ll} \displaystyle u_p Z_p(z)  \exp \left[ - \left( \frac{R(\lambda, \varphi; \lambda_p, \varphi_p)}{R_p} \right)^2 \right], & \mbox{if $R(\lambda, \varphi; \lambda_p, \varphi_p) < R_p$,} \\ 0, & \mbox{otherwise,} \end{array} \right.
\end{equation} where
\begin{equation}
Z_p(z) = \left\{ \begin{array}{ll} \displaystyle 1 - 3 \left( \frac{z}{z_p} \right)^2 + 2 \left( \frac{z}{z_p} \right)^3, & \mbox{if $z \leq z_p$,} \\ 0, & \mbox{otherwise.} \end{array} \right.
\end{equation}  Consequently, the perturbed velocity field takes the form
\begin{equation}
u(\lambda, \varphi, z) = u_{\text{ref}}(\varphi, z) + u^\prime(\lambda, \varphi, z).
\end{equation}

\subsection{Moist initial conditions}

We define the vertical $\eta$ coordinate as
\begin{equation}
\eta(\lambda, \varphi, z) = p(\lambda, \varphi, z) / p_s.
\end{equation}  Since the surface pressure of the moist air $p_s$ is constant with $p_s = p_0 = 1000$ hPa  the vertical coordinate $\eta$ is represented by $\eta = p/p_0$.  Specific humidity is specified in terms of $\eta$ as
\begin{eqnarray}
q(\lambda, \varphi, \eta) &=& \left\{ \begin{array}{ll} \displaystyle q_0 \exp\Bigg[- \Big(\frac{\varphi}{\varphi_{w}}\Big)^4 \Bigg] \exp\Bigg[- \Bigg(\frac{(\eta-1)p_0}{p_{w}}\Bigg)^2  \Bigg], & \mbox{if $\eta > p_t / p_s$,} \\ q_{t}, & \mbox{otherwise.} \end{array} \right.
\end{eqnarray} The functional form of $q$ and its parameters were inspired by observations. This moisture fields leads to maximum relative humidities around 85\% in the lower levels of the midlatitudes.

Note that the moist temperature is colder than the temperature one would obtain with $q = 0$. However, note that in the moist case the virtual temperature and moist pressure determine the strength of the pressure gradient term in the momentum equations. Since these are identical to the temperature and pressure in the dry case, the forcing by the pressure gradient term is the same in both the dry and moist variant of the baroclinic wave. The moist variant of the baroclinic wave without the temperature forcing from large-scale condensation should lead to almost identical results when compared to the dry version. Very small variations are expected since the moisture gets independently transported as a passive tracer in this case and some models utilize the moist variant of the physical constant $c_p$. If possible, the dry $c_p$ should be used. Comparing the evolution of the dry baroclinic wave to its moist variant (without large-scale condensation) can serve as a first sensibility check.

\subsection{Grid spacings, simulation time, output and diagnostics}

\clearpage

\section{Tropical cyclone}

The simplified tropical cyclone test case on a regular-size Earth is based on the work of \cite{reed2012idealized, reed2011analytic,reed2011impact, reed2011assessing}.  In this test an analytic vortex is initialized in a background environment which is tractable to a rapid intensification of tropical cyclones.  

\begin{table}[h]

\caption{List of constants used for the Ideaized Tropical Cyclone test}

\begin{tabular*}{\textwidth}{@{\extracolsep{\fill}}lll}
\hline Constant & Value & Description \\
\hline
$X$ & $1$ & small-planet scaling factor (regular-size Earth)\\
$z_t$ & $15000$ m & Tropopause height \\
$q_0$ & $0.021$ kg/kg & Maximum specific humidity amplitude \\
$q_t$ & $10^{-11}$ kg/kg & Specific humidity in the upper atmosphere \\
$T_0$ & $302.15$ K & Surface temperature of the air \\
$T_s$ & $302.15$ K & Sea surface temperature (SST), 29 C$^\circ$\\
$z_{q1}$ & $3000$ m & Height related to the linear decrease of $q$ with height \\
$z_{q2}$ & $8000$ m & Height related to the quadratic decrease of $q$ with height \\
$\Gamma$ & $0.007$\ K\ m$^{-1}$ & Virtual temperature lapse rate \\
$p_{b}$ & $1015$ hPa & Background surface pressure \\
$\varphi_c$ & $\pi / 18$ & Initial latitude of vortex center \\
$\lambda_c$ & $\pi$ & Initial longitude of vortex center \\
$\Delta p$ & $11.15$ hPa & Pressure perturbation at vortex center \\
$r_p$ & $282000$ m & Horizontal half-width of pressure perturbation \\
$z_p$ & $7000$ m & Height related to the vertical decay rate of $p$ perturbation \\
$\epsilon$ & $10^{-25}$ & Small threshold value \\
\hline 
\end{tabular*}

\end{table}

\subsection{Initialization}

The background state consists of a prescribed specific humidity profile, virtual temperature and pressure profile.  The initial profile is defined to be in approximate gradient wind balance.  The vertical sounding is chosen to roughly match an observed tropical sounding documented in \cite{jordan1958mean}.  The background specific humidity profile $\overline{q}(z)$ as a function of height $z$ is :

\begin{equation}
\begin{split}
\overline{q}(z)&=q_0 \exp\left(\frac{-z}{z_{q1}}\right)\exp\left(-\left(\frac{z}{z_{q2}}\right)^2\right) \text{ ~~for   } 0 \leq z \leq z_t \\
\overline{q}(z)&=q_t  \text{ ~~for   }  z_t \leq z
\end{split}
\end{equation}

The background virtual temperature sounding $\overline{T}_v(z)$ is split into two different representations for the lower and upper atmosphere.  It is given by
\begin{equation}
\begin{array}{ll} \label{eq2}
%\phantom{T_{vt} = }\overline{T}_v(z) = T_{v0} - \Gamma z & \mbox{for} \; 0 \le z \le z_t, \\
\overline{T}_v(z) = T_{v0} - \Gamma z & \mbox{for} \; 0 \le z \le z_t, \\
\overline{T}_v(z) = T_{vt} = T_{v0} - \Gamma z_t & \mbox{for} \; z_t < z, 
\end{array}
\end{equation}
~\\with the virtual temperature at the surface $T_{v0}$ = $T_0 (1+0.608 \, q_0)$ and the virtual temperature at the tropopause level $T_{vt}$ = $T_{v0} - \Gamma z_t$.  As a result, the background temperature profile $\overline{T}(z)$ is
\begin{eqnarray} \label{eq3}
\overline{T}(z) = \frac{\overline{T}_v(z)}{1 + 0.608\ \overline{q}(z)}.
\end{eqnarray}


Surface pressure is approximately constant away from the tropical cyclone, but drops as the storm is approached:
\begin{equation}
p_s=p_0 - \delta p \exp\left(-\frac{r_g}{r_p}^{n_r}\right)
\label{eq:tropical_cyclone_ps}
\end{equation}

The background vertical pressure profile $\overline{p}(z)$ of the moist air is computed using the hydrostatic balance and the surface pressure equation (\ref{eq:tropical_cyclone_ps}). The profile is given by:
\begin{equation}
\begin{split}
\overline{p}(z)&=p_s \exp\left(-\left(\frac{z}{zp}\right)^{2}\right)\left(\frac{T_0-\gamma z}{T_0}\right)^{\frac{g}{R_d\gamma}} \text{ ~~for   } 0 \leq z \leq z_t \\
\overline{p}(z)&=p_t \exp\left(-\frac{g(z_t-z)}{R_dT_{vt}}\right) \text{ ~~for   }  z_t \leq z
\end{split}
\end{equation}

\subsection{Axisymmetric Vortex}

The axisymmetric virtual temperature $T_v(r,z)$ is computed using the hydrostatic equation and ideal gas law (\ref{eq:idealgaslaw}).  Again it can be written as a sum of the background state and a perturbation,
\begin{equation} \label{eq:virt_temp}
T_v(r,z) = \overline{T}_v(z) + T_v^\prime(r,z),
\end{equation} where the virtual temperature perturbation is defined as

\begin{equation}
\begin{split}
\overline{T}(z)&=\frac{T_{v0}-\Gamma z}{(1+0.608q(z))\left(1+\frac{2R_d(T_0-\Gamma z)z}{\left( g z_p^2\frac{1-p_s}{\delta_p}\exp\left(\left(\frac{g_r}{r_p}\right)^{1.5}\right)\exp\left(\left(\frac{z}{z_p}\right)^2\right) \right)}   \right)} \text{ ~~for   } 0 \leq z \leq z_t \\
\overline{T}(z)&=T_{vt}  \text{ ~~for   }  z_t \leq z
\end{split}
\end{equation}

~\\with the virtual temperature at the surface $T_{v0}$ = $T_0 (1+0.608 \, q_0)$ and the virtual temperature at the tropopause level $T_{vt}$ = $T_{v0} - \Gamma z_t$

~\\Height equation:
\begin{equation}
z=\frac{T_0}{\Gamma}\left(1-\left(\frac{p}{p_s}\right) ^{\frac{R_d\Gamma}{g}}\right)
\end{equation}

\clearpage

\section{Mesoscale Storm}  \label{sec:3}

~\\ The study of mesoscale storm is the study of storm within a range of horizontal dimension  between 10 to hundreds kilometers. 

~\\The wind velocity, temperature and moisture are analytically defined. Potential temperature and relative humidity at the equator are altitude dependent and are defined by the following equations :

\begin{equation}
\begin{split}
\overline{\theta}(z)&=\theta_0 + (\theta_t - \theta_0)\left(\frac{z}{z_t}\right)^{\frac{5}{4}}  \ 0 \leq z \leq z_t \\
\overline{\theta}(z)&=\theta_t \exp\left(-\frac{g(z-z_t)}{c_pT_{t}}\right) \text{ ~~for   }  z_t \leq z
\end{split}
\end{equation}

 \begin{equation}
\begin{split}
\overline{H}(z)&=1 + \frac{3}{4}\left(\frac{z}{z_t}\right)^{\frac{5}{4}}  \ 0 \leq z \leq z_t \\
\overline{H}(z)&= \frac{1}{4} \text{ ~~for   }  z_t \leq z
\end{split}
\end{equation}

The saturation mixing ratio $q_{vs}$ is applied to initialize the water vapor ratio defined by $q = \overline{H}(z) q_{vs} $. The saturation mixing ratio equation is describe as :

 \begin{equation}
q_{vs}=\frac{380}{p}\exp\left(17.27\frac{ T-273}{T-36}\right)
\end {equation}

The zonal wind velocity equation follow the J.Klemp description as a continuous profile in three equations:

\begin{equation}
\begin{split}
\overline{u}(\phi,z)&=\left(U_s\frac{z}{z_t}-U_c\right)\cos(\phi)  \text{ ~~for   } z < z_s-1000 \\
\overline{u}(\phi,z)&=\left(-\frac{4}{5}+3\frac{z}{z_s}-\frac{5}{4}\frac{z^2}{z_s^2}\right)U_s-U_c \text{ ~~for   }  |z-z_s| \leq 1000 \\
\overline{u}(\phi,z)&=\left(U_s-U_c\right)\cos(\phi)  \text{ ~~for   } \text{ ~~for   }  z > z_s+1000 
\end{split}
\end{equation}



~\\ At initial condition the hydrostatic balance is requested. It can be written in function of the pressure and the temperature or as followed in terms of the exner function and the virtual potential temperature :

  \begin{equation}
 \frac{\partial{\Pi}}{\partial z} = - \frac{g}{c_p\theta_v}
 \end {equation}



\subsection{potential temperature perturbation}

A termal perturbation is added to the potential temperature field defined as follow

\begin{equation}
\begin{split}
\theta_i(\lambda,\phi,z)&=\overline{u}(\phi,z) + \Delta\phi\cos^2\left(\frac{\pi}{2}R_{\phi}\right) \text{ ~~for   } R_{\phi} < 1 \\
\theta_i(\lambda,\phi,z)&=\overline{u}(\phi,z) \text{ ~~for   } R_{\phi} \geq 1
\end{split}
\end{equation}


 \begin{equation}
T=\frac{theta_v}{1+0.61q}\left(\frac{p}{p_0}\right)^{\frac{R_d}{c_p}}
\end{equation}

\clearpage
\section{Terminator Physics}




\section{Toy Chemistry}

The toy chemetry test represent the photolysis-driven condition with the the following equation representing the combination and the dissociation.
\begin{equation}
\begin{split}
X+X&=X_2 \\
X_2&=X+X \\
\end{split}
\end{equation}

\begin{equation}
X_T=X+2X_2
\end{equation}

\begin{equation}
\begin{split}
\frac{dX}{dt}&=2k_1X_2-2k_2XX \\
\frac{dX_2}{dt}=-k_1X_2+k_2XX
\end{split}
\end{equation}

Therefore we have 
\begin{equation}
\frac{X_T}{dt}= \frac{d}{dt}[X+2X_2]=0
\end{equation}

This implie that $X_T$ is constant, with it value

\begin{equation}
\begin{split}
X_T=X(t)+2X_2(t)
X_T=X(0)+2X_2(0)
\end{split}
\end{equation}

Therefor we have
\begin{equation}
X_2=\frac{1}{2}(X_T-X(t))
\end{equation}

The two reaction rate coefficient  $k_1$ and $k_2$, representing the the photolytic breaking of molecule $X_2$ and the recombination. They can be describe as : 

\begin {equation}
\begin{split}
k_1(\lambda,\theta)&= max[0,\sin\theta\sin\theta_c+\cos\theta\cos\theta_c
\cos(\lambda-\lambda_c)] \\
k_2(\lambda,\theta)&=1
\end{split}
\end{equation}

Hence the molar mixing ration of cl will be implemented by :

\begin{equation}
X=\sqrt{\left(\frac{k_1}{4 k_2}\right)^2+2 X_T \frac{k_1}{4k_2} } - \frac{k_1}{4k_2}
\end{equation}

As follow $\text{cl}_2$ molar mixing ratio is :

\begin{equation}
X_2=\frac{1}{2}(_T-X)
\end{equation}

The tendency for cl and $\text{cl}_2$ is represnted by $ \frac{\partial q}{\partial t}$

\clearpage
\section{Kessler Physics}

~\\Pressure equation obey to the following equation, written using the moist equation of state.

\begin{equation}
p=\rho R_dT(1+0,61q_v)
\end{equation}

~\\ with $p$ the pressure , $\rho$ the density of moist air, $R_d$ the gas constant for dry air, $T$ the temperature and $q_v$ the mixing ratio of water vapor. The equation is rewritten as a nondimensional pressure $\Pi$ equation.

\begin{equation}
\Pi=\left(\frac{p}{p_0}\right)^{\frac{R_dT}{cp}}
\end{equation}


~\\To determine the saturation vapor mixing ratio the Teten's formula is used.

\begin{equation}
q_{vs}=\frac{3.8}{p}\exp\left(17.27\frac{\Pi \theta-273}{\Pi \theta-36}\right)
\end {equation}



~\\The autotconvection ($A_r$) and accreation ($C_r$) rates follow Kessler parametrization and are defined by :

\begin{equation}
\begin{split}
A_r&=k_1(q_c-a) \\
C_r&=k_2q_cq_r^{0.875}
\end{split}
\end{equation}
~\\ With $k_1=0.001 \text{s}^{-1}$, $a=0.001 \text{g}.\text{g}^{-1}$ and $k_2=2.2 \text{s}^{-1}$ 

~\\ Deriving from Klemp and Wilhelmson (1978) description of cloud water,rain water and water vapor mixing ratios. they are define as followed:
\begin{equation}
q_c^{n+1}=max(q_c^r-\Delta q_r,0)
\end{equation}
\begin{equation}
q_r^{n+1}=max(q_r^r-\Delta q_r+sed,0)
\end{equation}

~\\with sed the sedimentation term and $\Delta q_r$ define as :
\begin{equation}
\Delta q_r=q_c^n-\frac{q_c^n-\Delta \text{t} max(A_r,0)}{1+\Delta \text{t} C_r}
\end{equation}






~\\ The Rain evaporation equation is defined similarly to Ogura and Takshasi (1971) description:

\begin{equation}
E_r=\frac{1}{\rho}\frac{\left(1-\frac{q_v}{q_{vs}}\right)C(\rho q_r)^{0.525}}{5.4\times10^5+\frac{2.55\times10^6}{pq_{vs}}}
\end{equation}



~\\ With ventilation factor C define as 
\begin{equation}
C=1.6+124.9(\rho q_r)^{0.2046}
\label{venti}
\end{equation}



~\\ The liquid water terminal velocity is similar to Song and Ogura (1973) description with a mean density adjustement as suggested by Kessler (1969):

\begin{equation}
V=36349(\rho q_r)^{0.1346}\left(\frac{\rho}{\rho_0}\right)^{-\frac{1}{2}}
\end{equation}



\clearpage 
\appendix
\section{Annexe}

\begin{align*}
A&= \frac{1}{lapse} \\
B&=\frac{T_0-T_P}{T_0T_P} \\
C&=0.5(K+2) \frac{T_E-T_P}{T_ET_P} \\
H&=R_d\frac{T_0} {g}\\
Z&=\frac{z}{B H}  
\end{align*}


\begin{equation*}
T_0=0.5(T_E +T_P)
\end{equation*}

~\\Earth scalling parameter is used for the baroclinic instability, it initialization doesn't change from non scaled baroclinic instability. However the scalling parameter X as an effect on the the planet radius and it rotation rate. The impact on both of those parameter are the following $a_{ref}=a_{earth}/X$ and $\Omega_{ref}=\Omega{earth}X$ , nevertheless the product of the two is an changed 






\end{document}    